âœ… ä½œä¸š 1ï¼šè®¾ç½® `/tmp/test1/test2` çš„æƒé™ä¸º `rwxrwxrwt`ï¼ˆ1777ï¼‰

### ğŸ”§ æ­¥éª¤ 1. åˆ›å»ºç›®å½•ï¼š

```bash
mkdir -p /tmp/test1/test2
```

### ğŸ”§ æ­¥éª¤ 2. ä¿®æ”¹æƒé™ä¸º 1777ï¼ˆå¸¦ç²˜æ»ä½ï¼‰

```bash
chmod 1777 /tmp/test1
chmod 1777 /tmp/test1/test2
```

### âœ… éªŒè¯ï¼š

```bash
ls -ld /tmp/test1 /tmp/test1/test2
```

![image-20250721163728590](images/image-20250721163728590.png)

| æƒé™æ•°å€¼ | è¯´æ˜                               | å®‰å…¨æ€§ | ç”¨é€”                   |
| -------- | ---------------------------------- | ------ | ---------------------- |
| `0777`   | æ‰€æœ‰äººå¯è¯»å†™åˆ ï¼Œæ— é™åˆ¶             | âŒ å±é™© | ç¦ç”¨ï¼ˆæä¸å®‰å…¨ï¼‰       |
| `1777`   | ç²˜æ»ä½ï¼Œæ‰€æœ‰äººå¯å†™ï¼Œä¸èƒ½åˆ ä»–äººæ–‡ä»¶ | âœ… å®‰å…¨ | `/tmp` ç­‰å…¬å…±ä¸´æ—¶ç›®å½•  |
| `2777`   | SGID ä½ï¼Œæ–‡ä»¶è‡ªåŠ¨ç»§æ‰¿ç›®å½•ç»„        | âš ï¸ ä¸­ç­‰ | å°ç»„åä½œç›®å½•ï¼ˆéœ€è°¨æ…ï¼‰ |
| `3777`   | SGID + ç²˜æ»ä½ï¼Œç»„ç»§æ‰¿+å®‰å…¨åˆ é™¤æœºåˆ¶ | âœ… æ¨è | å®‰å…¨å…±äº«ç›®å½•           |

------

## âœ… ä½œä¸š 2ï¼šå°† `test1` å’Œ `test2` çš„æ‰€å±è€…è®¾å®šä¸º allenï¼Œæ‰€å±ç»„è®¾å®šä¸º nz2002

### ğŸ”§ æ­¥éª¤ 1. åˆ›å»ºç”¨æˆ·å’Œç»„

```bash
groupadd nz2002
useradd -g nz2002 allen
```

### ğŸ”§ æ­¥éª¤ 2. ä¿®æ”¹ç›®å½•æ‰€å±è€…å’Œç»„

```bash
chown allen:nz2002 /tmp/test1
chown allen:nz2002 /tmp/test1/test2
```

### âœ… éªŒè¯ï¼š

```bash
ls -ld /tmp/test1 /tmp/test1/test2
```

![image-20250721164014214](images/image-20250721164014214.png)

------

## âœ… ä½œä¸š 3ï¼šæ‰¾åˆ°ä¸¤ç§å‘½ä»¤å­—ï¼Œæˆäºˆ SUID æƒé™ï¼Œä»¥æ™®é€šç”¨æˆ·è¿è¡Œï¼Œæµ‹è¯•æ˜¯å¦ä»¥ root èº«ä»½æ‰§è¡Œ

### ğŸ”§ ç¤ºä¾‹å‘½ä»¤ 1ï¼š`/usr/bin/cat`ï¼ˆæ˜¾ç¤ºç³»ç»Ÿæ–‡ä»¶ï¼‰

```bash
chmod u+s /usr/bin/cat
```

### ğŸ”§ æ™®é€šç”¨æˆ·æµ‹è¯•ï¼š

```bash
cat /etc/shadow
```

å¦‚æœæ²¡æœ‰ SUIDï¼š**Permission denied**

![image-20250721164216958](images/image-20250721164216958.png) 

åŠ ä¸Š SUID åï¼š**æ™®é€šç”¨æˆ·å¯è¯» /etc/shadow**

![image-20250721164330741](images/image-20250721164330741.png)

------

### ğŸ”§ ç¤ºä¾‹å‘½ä»¤ 2ï¼šä½¿ç”¨ `awk` ææƒè¯»å–æ–‡ä»¶

```
sudo install -m 4755 $(which awk) /tmp/suidawk
```

ğŸ”§ æ™®é€šç”¨æˆ·æµ‹è¯•ï¼š

```
/tmp/suidawk '//' /etc/shadow
```

![image-20250721164948572](images/image-20250721164948572.png)



------

## ğŸ”§ ç¤ºä¾‹å‘½ä»¤ 3ï¼šsudo find ææƒ

### ğŸ§© æ“ä½œæµç¨‹ï¼š

#### ã€1ã€‘root ç”¨æˆ·é…ç½® sudo æƒé™

```bash
visudo
```

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š

```bash
allen ALL=(ALL) NOPASSWD: /usr/bin/find
```

è¯´æ˜ï¼šå…è®¸ `allen` æ— éœ€å¯†ç ä»¥ root èº«ä»½æ‰§è¡Œ `/usr/bin/find` å‘½ä»¤

![image-20250721170423650](images/image-20250721170423650.png)

------

#### ã€2ã€‘åˆ‡æ¢åˆ° allen ç”¨æˆ·ï¼Œæ‰§è¡Œææƒå‘½ä»¤

```bash
su - allen
sudo find . -exec /bin/sh \; -quit
```

- `-exec /bin/sh \;`ï¼šè°ƒç”¨ shellï¼ˆç»§æ‰¿ root æƒé™ï¼‰
- `-quit`ï¼šåªæ‰§è¡Œä¸€æ¬¡ï¼Œé¿å…éå†å¤§é‡æ–‡ä»¶

------

#### ã€3ã€‘ææƒéªŒè¯

æ‰§è¡Œ `id` æŸ¥çœ‹ UID æ˜¯å¦ä¸º 0ï¼ˆå³ rootï¼‰ï¼š

```bash
id
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
uid=0(root) gid=0(root) groups=0(root)
```

è¯´æ˜ï¼š`allen` å·²è·å– root æƒé™ï¼

![image-20250721170516442](images/image-20250721170516442.png)

