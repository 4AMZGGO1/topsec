# VLAN间单臂路由实验报告

## 一、实验目的

- 掌握华为交换机与路由设备的VLAN划分与配置。
- 熟悉802.1Q子接口配置，实现不同VLAN间的互通。
- 验证VLAN间的通信是否正常，并分析其实现原理。

------

## 二、实验拓扑

```
PC1 (192.168.10.10) --- E0/0/1  Access VLAN 10      |
                                                |
                       [SW1] -------- E0/0/3 Trunk ------- G0/0/0 [Router]
                                                |
PC2 (192.168.20.20) --- E0/0/2  Access VLAN 20      |
```

------

## 三、设备与接口说明

| 设备   | 接口     | 配置方式  | VLAN  | 说明               |
| ------ | -------- | --------- | ----- | ------------------ |
| SW1    | E0/0/1   | Access    | 10    | 连接PC1            |
| SW1    | E0/0/2   | Access    | 20    | 连接PC2            |
| SW1    | E0/0/3   | Trunk     | 10,20 | 连接路由器         |
| Router | G0/0/0.1 | Dot1Q终结 | 10    | 虚拟接口，子网网关 |
| Router | G0/0/0.2 | Dot1Q终结 | 20    | 虚拟接口，子网网关 |

------

## 四、配置过程

### 1. 交换机配置（SW1）

```bash
<Huawei> sys
[Huawei] sys sw1
[sw1] vlan batch 10 20

# 配置接口模式与VLAN
[sw1]int e0/0/1
[sw1-Ethernet0/0/1] port link-type access
[sw1-Ethernet0/0/1] port default vlan 10

[sw1]int e0/0/2
[sw1-Ethernet0/0/2] port link-type access
[sw1-Ethernet0/0/2] port default vlan 20

[sw1]int e0/0/3
[sw1-Ethernet0/0/3] port link-type trunk
[sw1-Ethernet0/0/3] port trunk allow-pass vlan 10 20
```

------

### 2. 路由器配置（子接口 + VLAN终结）

```bash
<Huawei> sys
[Huawei] sys router
[router] int g0/0/0.1
[router-GigabitEthernet0/0/0.1] dot1q termination vid 10
[router-GigabitEthernet0/0/0.1] arp broadcast enable
[router-GigabitEthernet0/0/0.1] ip address 192.168.10.1 255.255.255.0

[router] int g0/0/0.2
[router-GigabitEthernet0/0/0.2] dot1q termination vid 20
[router-GigabitEthernet0/0/0.2] arp broadcast enable
[router-GigabitEthernet0/0/0.2] ip address 192.168.20.1 255.255.255.0
```

------

## 五、测试验证

### 1. PC1 (VLAN 10, IP: 192.168.10.10) ping PC2 (VLAN 20, IP: 192.168.20.20)

抓包信息如下：

```
4	5.016000	192.168.10.10	192.168.20.20	ICMP	Echo (ping) request vlan10
5	5.016000	192.168.10.10	192.168.20.20	ICMP	Echo (ping) request vlan20
6	5.063000	192.168.20.20	192.168.10.10	ICMP	Echo (ping) reply   vlan20
7	5.063000	192.168.20.20	192.168.10.10	ICMP	Echo (ping) reply   vlan10
```

**结果：通信成功！**

------

## 六、实验总结

- 实验通过配置交换机Trunk口与路由器子接口，实现了基于802.1Q的VLAN间通信。
- 验证了不同VLAN（10与20）的主机可以通过三层设备正常互通。
- Dot1Q终结技术是实现“路由-交换一体化”的核心方式，适用于小型网络中的单臂路由模式。