# Windows 常用运维命令与网络基础笔记

---

## 1️⃣ 用户管理

### 📋 查看账户信息
- `net user` — 列出系统中的所有用户账户  
- `net user username` — 查看指定账户的详细信息（包含组信息）

### ➕ 添加用户
- `net user username password /add` — 添加新用户（`username` 为用户名，`password` 为密码）

### ➖ 删除用户
- `net user username /del` — 删除指定用户账户

### 🔓 激活/禁用用户
- `net user username /active:yes` — 激活用户账户  
- `net user username /active:no` — 禁用用户账户

### 👤 查看当前用户 SID
- `whoami /user` — 查看当前登录用户的 SID

  | SID          | 说明                        |
  | ------------ | --------------------------- |
  | -500         | 内置管理员（Administrator） |
  | -501         | 来宾账户（Guest）           |
  | -1000 及以上 | 普通用户                    |

### 🔑 修改用户所属组
- `net localgroup administrators username /add` — 将用户添加到管理员组  
- `net localgroup "Remote Desktop Users" username /add` — 将用户添加到远程桌面用户组（允许使用 RDP）

---

## 2️⃣ 远程登录

### 常用协议与端口

| 协议                | 端口 |
| ------------------- | ---- |
| RDP（远程桌面协议） | 3389 |
| SSH（安全外壳协议） | 22   |
| Telnet              | 23   |
| SMB（文件共享）     | 445  |

### 启用远程桌面

- 默认情况下，普通用户需要加入 **Remote Desktop Users** 组才能远程登录。
- 使用命令 `mstsc` 打开远程桌面连接窗口。

---

## 3️⃣ 文件系统

| 文件系统 | 特点                                    |
| -------- | --------------------------------------- |
| NTFS     | 支持大于 4GB 文件，支持权限管理、加密等 |
| FAT32    | 最大单个文件 4GB，不适合大文件存储      |

---

## 4️⃣ 网络管理

### 查看开放端口
- `netstat -an` — 查看所有端口状态

### 删除默认共享
- `net share c$ /del` — 删除指定的网络共享（`c$` 是管理员默认共享）

---

## 5️⃣ 密码和账户安全

### 密码存储路径
- Windows 账户密码存储在：  
  `C:\Windows\System32\config\SAM`

### 常见破解方式
- **撞库攻击**：使用已知用户名/密码组合尝试暴力登录
- **PE系统**:绕开主系统删除sam文件，删除密码

### 默认密码有效期
- Windows 密码默认有效期为 42 天，过期后需要更改。

---

## 6️⃣ DHCP（动态主机配置协议）

### 作用
- 自动为客户端分配 IP 地址、子网掩码、网关、DNS 等参数。

### 端口
- 服务器监听端口：`67`
- 客户端使用端口：`68`

### 客户端 IP 管理命令
- `ipconfig /release` — 释放 IP（取消租约）
- `ipconfig /renew` — 重新获取 IP

### DHCP 工作过程

1. **DHCP Discovery**：客户端广播请求 IP（目标 255.255.255.255:67，包含 MAC）
2. **DHCP Offer**：服务器响应提供可用 IP
3. **DHCP Request**：客户端正式请求指定 IP
4. **DHCP ACK**：服务器确认分配，提供详细网络参数（IP、掩码、网关、DNS、租期）
5. **其他报文**：
   - **Decline**：客户端检测到 IP 冲突，告知服务器
   - **NAK**：服务器拒绝分配
   - **Release**：客户端主动释放 IP

### 租期续约示例

- 客户端在租期 50% 时（T1）发 Request 包续约  
- 若 T1 失败，87.5%（T2）时再次尝试  
- 若仍失败，释放 IP，重新发送 Discovery 获取新地址  
- 若多次失败，则自动分配临时 IP：`169.254.x.x/16`（APIPA）

---

## 7️⃣ DNS（域名服务）

### 端口
- `53`（UDP/TCP）

### 解析流程
1. 本地 DNS 缓存  
   - 查看缓存：`ipconfig /displaydns`
   - 清空缓存：`ipconfig /flushdns`
2. 本机 `hosts` 文件
   - 路径：`C:\Windows\System32\drivers\etc\hosts`
   - 示例：  
     ```plaintext
     echo 123.123.123.123 www.jd.com >> C:\Windows\System32\drivers\etc\hosts
     ```

3. 指定 DNS 服务器  
4. DNS 转发器 → 根域

---

## 8️⃣ Web 服务器 & FTP

### 常用端口

| 服务         | 端口 |
| ------------ | ---- |
| HTTP         | 80   |
| HTTPS        | 443  |
| FTP 控制端口 | 21   |
| FTP 数据端口 | 20   |

> 0–1024 端口一般保留给系统/服务使用，如：445（SMB）、23（Telnet）、22（SSH）、67/68（DHCP）、21/20（FTP）、25（SMTP）、53（DNS）、3389（RDP）

### FTP 主动/被动模式

- **主动（PORT）**：客户端告诉服务端自己的 IP/端口 → 服务端连接客户端  
- **被动（PASV）**：服务端提供端口 → 客户端主动连接该端口

- **匿名用户**：`anonymous`

---

## 9️⃣ 域（AD）

### 集中管理优点
1. 域成员机可允许域用户登录
2. 可限制用户登录时间、应用程序访问
3. 强制部署软件、统一配置（如桌面壁纸）

### 域控（DC）
- 必须安装 **AD DS（活动目录域服务）**
- 域控需固定 IP
- 依赖 DNS 支持
- 需要唯一的域名（如：`topsec.com`）

------

## 🔟 PKI（公钥基础设施）

### 组成部分

- **公钥加密技术**：基于公钥和私钥的加密算法，用于保证数据的机密性和完整性。
- **数字证书**：用于证明公钥的合法性和身份验证。
- **CA（证书授权中心）**：负责数字证书的颁发与管理。
- **RA（注册机构）**：负责处理证书申请及用户身份验证。

### 信息安全三要素

1. **机密性**：数据只有授权方可以读取。
2. **完整性**：数据在传输过程中未被篡改。
3. **可用性**：数据及服务对授权方可用。
4. **操作的不可否认性/身份验证**：操作完成后，相关人员不可否认其行为，确保身份验证有效。

### 加密算法

1. **对称加密算法**：
   - 使用单一密钥进行加密与解密。
   - **优点**：加密速度快。
   - **缺点**：密钥传输过程容易被窃取。
   - **常见算法**：DES、3DES、AES（高级加密标准）。
2. **非对称加密算法**：
   - 使用一对密钥（公钥和私钥），公钥加密，私钥解密，或反之。
   - **常见算法**：RSA、ECC（椭圆曲线加密）。
3. **哈希算法**：
   - 用于保证数据完整性，生成固定长度的哈希值。
   - **常见算法**：MD5、SHA（SHA-1、SHA-256等）。
   - **特性**：
     - 相同明文经过哈希处理后得到相同的哈希值。
     - 不管输入数据的大小，哈希值长度固定。
     - 不可逆，即无法从哈希值推算回明文。

### 签名过程

- 签名是通过将数据哈希值进行私钥加密的方式生成数字签名，确保数据的完整性及认证身份。

------

### 证书申请流程

1. **生成密钥对**：
   - **申请方（如Topsec）**在自己的服务器上生成一对密钥：
     - 公钥（Public Key）
     - 私钥（Private Key，需保密）
2. **生成证书签名请求（CSR）**：
   - Topsec 使用自己的公钥和组织信息（如域名、组织名等）生成一个 **CSR 文件**（证书签名请求）。
   - CSR 文件包含：
     - 申请方的公钥
     - 申请方的相关信息（如域名、组织名等）
     - 一个签名（用私钥对信息进行签名，确保公钥确实是由申请方生成的）
3. **提交 CSR 给 CA**：
   - Topsec 将 **CSR 文件** 提交给 **CA（证书授权中心）**。
4. **CA 审核并签发证书**：
   - CA 对申请方的信息（如域名所有权、公司资质等）进行审核。
   - 审核通过后，CA 用其私钥对申请方的公钥进行数字签名，生成正式的 **数字证书**。
   - 该证书包含：
     - 申请方的公钥
     - 申请方的相关信息
     - CA 的签名
5. **安装证书**：
   - 申请方将 **数字证书** 安装到自己的服务器上（Web 服务器、VPN 设备等）。
6. **客户端访问时的验证**：
   - 客户端（如浏览器）访问时，服务器会返回数字证书。
   - 客户端使用内置的 **CA 公钥** 验证证书的合法性：
     - 验证证书签名的有效性（确保证书未被伪造）。
     - 验证域名是否匹配。
     - 验证证书是否过期或吊销。
7. **建立安全连接（TLS/SSL）**：
   - 验证通过后，客户端和服务器使用证书中的公钥完成安全握手。
   - 双方协商生成一个临时的对称密钥（Session Key）。
   - 之后的通信将使用此对称密钥进行加密，确保数据传输的安全性。

